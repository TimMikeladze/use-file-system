/*! For license information please see stories-Example-stories.26a651a2.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkuse_file_system=self.webpackChunkuse_file_system||[]).push([[233],{"./src/stories/Example.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Example_stories});var react=__webpack_require__("./node_modules/react/index.js"),chunk_AY7I2SME=__webpack_require__("./node_modules/@storybook/addon-actions/dist/chunk-AY7I2SME.mjs"),ignore=(__webpack_require__("./node_modules/@storybook/addon-actions/dist/chunk-VWCVBQ22.mjs"),__webpack_require__("./node_modules/ignore/index.js")),ignore_default=__webpack_require__.n(ignore);const commonFilters=[async()=>{const isDist=filepath=>!!filepath.includes("/dist/")||(!!filepath.includes("/out/")||(!!filepath.includes("/build/")||(!!filepath.includes("/vendor/")||(!!filepath.includes("/node_modules/")||!!filepath.includes("/.next/")))));return{shouldIncludeFile:async(filepath,handle)=>!isDist(filepath),shouldProcessDirectory:async(filepath,handle)=>!isDist(filepath)}},async()=>{const isMisc=filepath=>!!filepath.endsWith(".DS_Store");return{shouldIncludeFile:async(filepath,handle)=>!isMisc(filepath),shouldProcessDirectory:async(filepath,handle)=>!isMisc(filepath)}},async()=>{const ig=ignore_default()({allowRelativePaths:!0});let gitIgnoreLoaded=!1;return{shouldIncludeFile:async(filepath,handle)=>{if(filepath.endsWith(".gitignore")&&!gitIgnoreLoaded){const file=await handle.getFile(),text=await file.text();return ig.add(text),gitIgnoreLoaded=!0,!1}const{ignored}=ig.test(filepath);return!ignored},shouldProcessDirectory:async(filepath,handle)=>{const{ignored}=ig.test(filepath);return!filepath.endsWith(".git")&&(!filepath.includes(".git/")&&!ignored)}}}],processDirectory=async(directoryHandle,directoryPath,filters,includeFiles,ignoreFilePaths)=>{for await(const handle of directoryHandle.values()){const path=`${directoryPath}/${handle.name}`;if(!ignoreFilePaths.has(path)&&"file"===handle.kind)for(const filter of filters)ignoreFilePaths.has(path)||(await filter.shouldIncludeFile(path,handle)?includeFiles.set(path,handle):(ignoreFilePaths.add(path),includeFiles.delete(path)))}const directories=new Map;for await(const handle of directoryHandle.values()){const path=`${directoryPath}/${handle.name}`;if(!ignoreFilePaths.has(path)&&"directory"===handle.kind)for(const filter of filters)ignoreFilePaths.has(path)||(await filter.shouldProcessDirectory(path,handle)?directories.set(path,handle):(ignoreFilePaths.add(path),includeFiles.delete(path)))}for(const[path,handle]of directories)if(!ignoreFilePaths.has(path))for(const filter of filters)ignoreFilePaths.has(path)||(await filter.shouldProcessDirectory(path,handle)?await processDirectory(handle,path,filters,includeFiles,ignoreFilePaths):(ignoreFilePaths.add(path),includeFiles.delete(path)));return includeFiles},useFileSystem=props=>{const{onFilesAdded:onAddFile,onFilesChanged:onChangeFile,onFilesDeleted:onDeleteFile}=props,watchedDirectoriesRef=(0,react.useRef)(new Map),handlesRef=(0,react.useRef)(new Map),previousHandlesRef=(0,react.useRef)(new Set),filesMapRef=(0,react.useRef)({}),previousFilesMapRef=(0,react.useRef)({}),intervalRef=(0,react.useRef)(),[files,setFiles]=(0,react.useState)(new Map),[isProcessing,setIsProcessing]=(0,react.useState)(!1),processWatchedDirectories=(0,react.useCallback)((async()=>{const temporaryHandles=new Map,ignoreFilePaths=new Set,filterFns=props.filters||[],filters=[];for(const filterFn of filterFns)filters.push(await filterFn());for(const[directoryPath,directoryHandle]of watchedDirectoriesRef.current)await processDirectory(directoryHandle,directoryPath,filters,temporaryHandles,ignoreFilePaths);for(const[filePath]of temporaryHandles)ignoreFilePaths.has(filePath)&&temporaryHandles.delete(filePath);handlesRef.current=new Map(Array.from(temporaryHandles))}),[props.filters]),processFiles=(0,react.useCallback)((async()=>{previousFilesMapRef.current={...filesMapRef.current||{}};const seenFiles=new Set,changedFiles=new Map,deletedFilesSet=new Set;let rerender=!1;await Promise.all(Array.from(handlesRef.current).map((async([filePath,handle])=>{if(handle&&handle?.getFile){seenFiles.add(filePath);try{const file=await handle.getFile(),text=await file.text();text!==filesMapRef.current[filePath]&&(filesMapRef.current[filePath]=text,changedFiles.set(filePath,text))}catch(error){handlesRef.current.delete(filePath),deletedFilesSet.add(filePath),delete filesMapRef.current[filePath],rerender=!0}}})));const deletedFiles=Array.from([...Array.from(previousHandlesRef.current),...Array.from(deletedFilesSet)]).filter((filePath=>!seenFiles.has(filePath))),addedFiles=Array.from(seenFiles).filter((filePath=>!previousHandlesRef.current.has(filePath))),addedFilesMap=new Map;for(const addedFile of addedFiles)addedFilesMap.set(addedFile,filesMapRef.current[addedFile]);const deletedFilesMap=new Map;for(const deletedFile of deletedFiles)deletedFilesMap.set(deletedFile,filesMapRef.current[deletedFile]),handlesRef.current.delete(deletedFile),delete filesMapRef.current[deletedFile];const previousFiles=new Map(Array.from(previousHandlesRef.current).map((filePath=>[filePath,filesMapRef.current[filePath]])));if(changedFiles.size&&(rerender=!0,onChangeFile?.(changedFiles,previousFiles)),deletedFiles.length&&(rerender=!0,onDeleteFile?.(deletedFilesMap,previousFiles)),addedFiles.length&&(rerender=!0,onAddFile?.(addedFilesMap,previousFiles)),previousHandlesRef.current=seenFiles,!rerender&&Object.keys(filesMapRef.current).length===Object.keys(previousFilesMapRef.current).length)for(const[filePath,text]of Object.entries(filesMapRef.current))if(previousFilesMapRef.current[filePath]!==text){rerender=!0;break}rerender&&setFiles(new Map(Object.entries(filesMapRef.current)))}),[onAddFile,onChangeFile,onDeleteFile]),startPollingWatchedDirectories=(0,react.useCallback)((()=>{intervalRef.current=setInterval((async()=>{isProcessing||(setIsProcessing(!0),await processWatchedDirectories(),await processFiles(),setIsProcessing(!1))}),props.pollInterval||500)}),[processWatchedDirectories,processFiles,isProcessing]);return useUnmount((()=>{intervalRef.current&&clearInterval(intervalRef.current)})),{handles:handlesRef.current,onDirectorySelection:async()=>{try{const directoryHandle=await window.showDirectoryPicker();if(!directoryHandle)return;const initialDirectoryPath=directoryHandle.name;watchedDirectoriesRef.current.set(initialDirectoryPath,directoryHandle),intervalRef.current&&clearInterval(intervalRef.current),startPollingWatchedDirectories()}catch(error){console.error("Error during directory selection:"),console.error(error)}},files,isProcessing,isBrowserSupported:void 0!==window&&"showDirectoryPicker"in window}},useUnmount=fn=>{const fnRef=(0,react.useRef)(fn);var effect;fnRef.current=fn,effect=()=>()=>fnRef.current(),(0,react.useEffect)(effect,[])};try{useFileSystem.displayName="useFileSystem",useFileSystem.__docgenInfo={description:"",displayName:"useFileSystem",props:{filters:{defaultValue:null,description:"",name:"filters",required:!1,type:{name:"FilterFn[]"}},onFilesAdded:{defaultValue:null,description:"",name:"onFilesAdded",required:!1,type:{name:"((newFiles: Map<string, string>, previousFiles: Map<string, string>) => void)"}},onFilesChanged:{defaultValue:null,description:"",name:"onFilesChanged",required:!1,type:{name:"((changedFiles: Map<string, string>, previousFiles: Map<string, string>) => void)"}},onFilesDeleted:{defaultValue:null,description:"",name:"onFilesDeleted",required:!1,type:{name:"((deletedFiles: Map<string, string>, previousFiles: Map<string, string>) => void)"}},pollInterval:{defaultValue:null,description:"",name:"pollInterval",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/useFileSystem.tsx#useFileSystem"]={docgenInfo:useFileSystem.__docgenInfo,name:"useFileSystem",path:"src/useFileSystem.tsx#useFileSystem"})}catch(__react_docgen_typescript_loader_error){}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Example=()=>{const{onDirectorySelection,files,isBrowserSupported}=useFileSystem({filters:commonFilters,onFilesAdded:(newFiles,previousFiles)=>{console.log("onFilesAdded",newFiles,previousFiles),(0,chunk_AY7I2SME.aD)("onFilesAdded")},onFilesChanged:(changedFiles,previousFiles)=>{console.log("onFilesChanged",changedFiles,previousFiles),(0,chunk_AY7I2SME.aD)("onFilesChanged")},onFilesDeleted:(deletedFiles,previousFiles)=>{console.log("onFilesDeleted",deletedFiles,previousFiles),(0,chunk_AY7I2SME.aD)("onFilesDeleted")}}),[renderCount,setRenderCount]=react.useState(0);return(0,react.useEffect)((()=>{setRenderCount((count=>count+1))}),[files]),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[!isBrowserSupported&&(0,jsx_runtime.jsx)("div",{style:{color:"red"},children:"Your browser does not support the File System Access API. Please try again in a different browser, such as Chrome."}),(0,jsx_runtime.jsx)("div",{children:"Select a directory on your file-system to watch for changes. The files will be listed below. If you have a .gitignore file in the directory, the files will be filtered according to the rules in that file."}),(0,jsx_runtime.jsx)("div",{children:"Component will re-render when files are added, changed, or deleted."}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{children:["Number of renders: ",renderCount]})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{children:["Number of files: ",files.size]})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{type:"button",onClick:onDirectorySelection,children:"Click here"})}),(0,jsx_runtime.jsx)("div",{children:Array.from(files).map((([filePath])=>(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("div",{children:filePath})},filePath)))})]})};Example.displayName="Example";const Example_stories={title:"Example",component:Example,argTypes:{}},Template=()=>(0,jsx_runtime.jsx)(Example,{});Template.displayName="Template";const Primary=Template.bind({});Primary.args={},Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"() => <Example />",...Primary.parameters?.docs?.source}}};const __namedExportsOrder=["Primary"]},"./node_modules/ignore/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var process=__webpack_require__("./node_modules/process/browser.js");function makeArray(subject){return Array.isArray(subject)?subject:[subject]}const REGEX_TEST_BLANK_LINE=/^\s+$/,REGEX_INVALID_TRAILING_BACKSLASH=/(?:[^\\]|^)\\$/,REGEX_REPLACE_LEADING_EXCAPED_EXCLAMATION=/^\\!/,REGEX_REPLACE_LEADING_EXCAPED_HASH=/^\\#/,REGEX_SPLITALL_CRLF=/\r?\n/g,REGEX_TEST_INVALID_PATH=/^\.*\/|^\.+$/;let TMP_KEY_IGNORE="node-ignore";"undefined"!=typeof Symbol&&(TMP_KEY_IGNORE=Symbol.for("node-ignore"));const KEY_IGNORE=TMP_KEY_IGNORE,REGEX_REGEXP_RANGE=/([0-z])-([0-z])/g,RETURN_FALSE=()=>!1,REPLACERS=[[/\\?\s+$/,match=>0===match.indexOf("\\")?" ":""],[/\\\s/g,()=>" "],[/[\\$.|*+(){^]/g,match=>`\\${match}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function startingReplacer(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(_,index,str)=>index+6<str.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(_,p1,p2)=>p1+p2.replace(/\\\*/g,"[^\\/]*")],[/\\\\\\(?=[$.|*+(){^])/g,()=>"\\"],[/\\\\/g,()=>"\\"],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(match,leadEscape,range,endEscape,close)=>"\\"===leadEscape?`\\[${range}${(slashes=>{const{length}=slashes;return slashes.slice(0,length-length%2)})(endEscape)}${close}`:"]"===close&&endEscape.length%2==0?`[${(range=>range.replace(REGEX_REGEXP_RANGE,((match,from,to)=>from.charCodeAt(0)<=to.charCodeAt(0)?match:"")))(range)}${endEscape}]`:"[]"],[/(?:[^*])$/,match=>/\/$/.test(match)?`${match}$`:`${match}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(_,p1)=>`${p1?`${p1}[^/]+`:"[^/]*"}(?=$|\\/$)`]],regexCache=Object.create(null),isString=subject=>"string"==typeof subject;class IgnoreRule{constructor(origin,pattern,negative,regex){this.origin=origin,this.pattern=pattern,this.negative=negative,this.regex=regex}}const createRule=(pattern,ignoreCase)=>{const origin=pattern;let negative=!1;0===pattern.indexOf("!")&&(negative=!0,pattern=pattern.substr(1));const regex=((pattern,ignoreCase)=>{let source=regexCache[pattern];return source||(source=REPLACERS.reduce(((prev,current)=>prev.replace(current[0],current[1].bind(pattern))),pattern),regexCache[pattern]=source),ignoreCase?new RegExp(source,"i"):new RegExp(source)})(pattern=pattern.replace(REGEX_REPLACE_LEADING_EXCAPED_EXCLAMATION,"!").replace(REGEX_REPLACE_LEADING_EXCAPED_HASH,"#"),ignoreCase);return new IgnoreRule(origin,pattern,negative,regex)},throwError=(message,Ctor)=>{throw new Ctor(message)},checkPath=(path,originalPath,doThrow)=>{if(!isString(path))return doThrow(`path must be a string, but got \`${originalPath}\``,TypeError);if(!path)return doThrow("path must not be empty",TypeError);if(checkPath.isNotRelative(path)){return doThrow(`path should be a ${"`path.relative()`d"} string, but got "${originalPath}"`,RangeError)}return!0},isNotRelative=path=>REGEX_TEST_INVALID_PATH.test(path);checkPath.isNotRelative=isNotRelative,checkPath.convert=p=>p;class Ignore{constructor({ignorecase=!0,ignoreCase=ignorecase,allowRelativePaths=!1}={}){var object,key,value;object=this,key=KEY_IGNORE,value=!0,Object.defineProperty(object,key,{value}),this._rules=[],this._ignoreCase=ignoreCase,this._allowRelativePaths=allowRelativePaths,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(pattern){if(pattern&&pattern[KEY_IGNORE])return this._rules=this._rules.concat(pattern._rules),void(this._added=!0);if((pattern=>pattern&&isString(pattern)&&!REGEX_TEST_BLANK_LINE.test(pattern)&&!REGEX_INVALID_TRAILING_BACKSLASH.test(pattern)&&0!==pattern.indexOf("#"))(pattern)){const rule=createRule(pattern,this._ignoreCase);this._added=!0,this._rules.push(rule)}}add(pattern){return this._added=!1,makeArray(isString(pattern)?(pattern=>pattern.split(REGEX_SPLITALL_CRLF))(pattern):pattern).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(pattern){return this.add(pattern)}_testOne(path,checkUnignored){let ignored=!1,unignored=!1;return this._rules.forEach((rule=>{const{negative}=rule;if(unignored===negative&&ignored!==unignored||negative&&!ignored&&!unignored&&!checkUnignored)return;rule.regex.test(path)&&(ignored=!negative,unignored=negative)})),{ignored,unignored}}_test(originalPath,cache,checkUnignored,slices){const path=originalPath&&checkPath.convert(originalPath);return checkPath(path,originalPath,this._allowRelativePaths?RETURN_FALSE:throwError),this._t(path,cache,checkUnignored,slices)}_t(path,cache,checkUnignored,slices){if(path in cache)return cache[path];if(slices||(slices=path.split("/")),slices.pop(),!slices.length)return cache[path]=this._testOne(path,checkUnignored);const parent=this._t(slices.join("/")+"/",cache,checkUnignored,slices);return cache[path]=parent.ignored?parent:this._testOne(path,checkUnignored)}ignores(path){return this._test(path,this._ignoreCache,!1).ignored}createFilter(){return path=>!this.ignores(path)}filter(paths){return makeArray(paths).filter(this.createFilter())}test(path){return this._test(path,this._testCache,!0)}}const factory=options=>new Ignore(options);if(factory.isPathValid=path=>checkPath(path&&checkPath.convert(path),path,RETURN_FALSE),factory.default=factory,module.exports=factory,void 0!==process&&(process.env&&process.env.IGNORE_TEST_WIN32||"win32"===process.platform)){const makePosix=str=>/^\\\\\?\\/.test(str)||/["<>|\u0000-\u001F]+/u.test(str)?str:str.replace(/\\/g,"/");checkPath.convert=makePosix;const REGIX_IS_WINDOWS_PATH_ABSOLUTE=/^[a-z]:\//i;checkPath.isNotRelative=path=>REGIX_IS_WINDOWS_PATH_ABSOLUTE.test(path)||isNotRelative(path)}},"./node_modules/react/cjs/react-jsx-runtime.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var f=__webpack_require__("./node_modules/react/index.js"),k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(c,a,g){var b,d={},e=null,h=null;for(b in void 0!==g&&(e=""+g),void 0!==a.key&&(e=""+a.key),void 0!==a.ref&&(h=a.ref),a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.jsx=q,exports.jsxs=q},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.min.js")}}]);